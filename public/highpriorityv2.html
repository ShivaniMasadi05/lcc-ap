<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>High Priority CCMS2 Cases Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background: #f5f6fa; min-height: 100vh; color: #333; }
    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
    .header { text-align: center; margin-bottom: 30px; color: #2c3e50; }
    .header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; }
    .header p { font-size: 1.1rem; opacity: 0.7; color: #6c757d; }
    .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: white; padding: 25px 20px; border-radius: 16px; text-align: center; box-shadow: 0 8px 32px rgba(0,0,0,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer; position: relative; overflow: hidden; }
    .stat-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--accent-color, #007bff), var(--accent-light, #4dabf7)); }
    .stat-card:hover { transform: translateY(-5px); box-shadow: 0 16px 48px rgba(0,0,0,0.15); }
    .stat-card.active { background: #495057; color: white; transform: translateY(-3px); }
    .stat-card.overdue { --accent-color: #e74c3c; --accent-light: #ec7063; }
    .stat-card.today { --accent-color: #27ae60; --accent-light: #58d68d; }
    .stat-card.tomorrow { --accent-color: #f39c12; --accent-light: #f7dc6f; }
    .stat-card.upcoming { --accent-color: #3498db; --accent-light: #7fb3d3; }
    .stat-card.total { --accent-color: #8e44ad; --accent-light: #bb8fce; }
    .stat-number { font-size: 2.5rem; font-weight: 700; margin-bottom: 8px; color: var(--accent-color, #007bff); }
    .stat-card.active .stat-number { color: white; }
    .stat-label { font-size: 0.9rem; font-weight: 500; opacity: 0.8; text-transform: uppercase; letter-spacing: 0.5px; }
    .stat-icon { font-size: 1.5rem; margin-bottom: 10px; }
    .cases-container { background: white; border-radius: 20px; box-shadow: 0 20px 64px rgba(0,0,0,0.1); overflow: hidden; min-height: 500px; }
    .cases-header { background: #ffffff; padding: 20px 30px; border-bottom: 1px solid #e9ecef; }
    .cases-title { font-size: 1.5rem; font-weight: 600; color: #2c3e50; margin-bottom: 5px; }
    .cases-subtitle { color: #6c757d; font-size: 0.9rem; }
    .cases-content { padding: 0; max-height: 70vh; overflow-y: auto; }
    .case-card { padding: 20px 30px; border-bottom: 1px solid #f1f3f4; transition: all 0.3s ease; position: relative; }
    .case-card:hover { background: #f8f9fa; padding-left: 35px; }
    .case-card:last-child { border-bottom: none; }
    .case-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background: var(--status-color, #007bff); opacity: 0; transition: opacity 0.3s ease; }
    .case-card:hover::before { opacity: 1; }
    .case-card.overdue { --status-color: #e74c3c; background: rgba(231, 76, 60, 0.05); }
    .case-card.today { --status-color: #27ae60; background: rgba(39, 174, 96, 0.05); }
    .case-card.tomorrow { --status-color: #f39c12; background: rgba(243, 156, 18, 0.05); }
    .case-card.upcoming { --status-color: #3498db; }
    .case-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; flex-wrap: wrap; gap: 15px; }
    .case-info { flex: 1; min-width: 250px; }
    .case-title { font-size: 1.1rem; font-weight: 600; color: #2c3e50; margin-bottom: 8px; line-height: 1.3; }
    .case-meta { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 10px; }
    .meta-item { display: flex; align-items: center; gap: 5px; font-size: 0.85rem; color: #6c757d; }
    .meta-icon { font-size: 0.9rem; }
    .case-status { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
    .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 500; text-transform: uppercase; letter-spacing: 0.3px; }
    .status-priority { background: #e74c3c; color: white; }
    .status-stage { background: #e9ecef; color: #495057; }
    .status-repeat { background: #d5f4e6; color: #27ae60; }
    .status-hearing { background: var(--status-color, #007bff); color: white; font-weight: 600; }
    .case-parties { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px; }
    .party { min-width: 0; }
    .party-label { font-size: 0.75rem; font-weight: 600; color: #6c757d; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
    .party-name { font-weight: 500; color: #2c3e50; word-wrap: break-word; }
    .case-synopsis { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9rem; line-height: 1.5; color: #495057; border-left: 3px solid var(--status-color, #007bff); }
    .case-actions { display: flex; flex-wrap: wrap; gap: 10px; justify-content: flex-end; }
    .btn { padding: 8px 16px; border: none; border-radius: 8px; font-size: 0.85rem; font-weight: 500; cursor: pointer; transition: all 0.3s ease; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .btn-primary { background: #3498db; color: white; }
    .btn-success { background: #27ae60; color: white; }
    .btn-warning { background: #f39c12; color: white; }
    .btn-danger { background: #e74c3c; color: white; }
    .btn-secondary { background: #6c757d; color: white; }
    .loading, .no-cases { text-align: center; padding: 60px 20px; color: #6c757d; }
    .loading { font-size: 1.1rem; }
    .loading::after { content: ''; display: inline-block; width: 20px; height: 20px; border: 2px solid #6c757d; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-left: 10px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .no-cases { font-size: 1.2rem; }
    .error { color: #721c24; background: #f8d7da; padding: 20px; border-radius: 8px; border: 1px solid #f5c6cb; margin: 20px; }
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(5px); }
    .modal-content { background-color: white; margin: 5% auto; padding: 0; border-radius: 16px; width: 90%; max-width: 700px; box-shadow: 0 20px 64px rgba(0,0,0,0.3); overflow: hidden; max-height: 80vh; }
    .modal-header { background: #495057; color: white; padding: 25px 30px; display: flex; justify-content: space-between; align-items: center; }
    .modal-title { font-size: 1.3rem; font-weight: 600; }
    .close { font-size: 24px; font-weight: bold; cursor: pointer; color: white; opacity: 0.8; transition: opacity 0.3s ease; }
    .close:hover { opacity: 1; }
    .modal-body { padding: 30px; line-height: 1.6; color: #495057; max-height: 60vh; overflow-y: auto; }
    @media (max-width: 768px) { .container { padding: 15px; } .header h1 { font-size: 2rem; } .stats-container { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; } .stat-number { font-size: 2rem; } .case-header { flex-direction: column; align-items: stretch; } .case-parties { grid-template-columns: 1fr; gap: 15px; } .case-actions { justify-content: center; } .cases-content { max-height: 60vh; } }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üèõÔ∏è High Priority Cases Dashboard</h1>
    <p>Real-time monitoring of critical CCMS2 cases</p>
  </div>
  <div class="stats-container">
    <div class="stat-card total active" data-filter="all"><div class="stat-icon">üìä</div><div class="stat-number" id="count-all">0</div><div class="stat-label">Total Cases</div></div>
    <div class="stat-card overdue" data-filter="overdue"><div class="stat-icon">‚ö†Ô∏è</div><div class="stat-number" id="count-overdue">0</div><div class="stat-label">Overdue</div></div>
    <div class="stat-card today" data-filter="today"><div class="stat-icon">üìÖ</div><div class="stat-number" id="count-today">0</div><div class="stat-label">Today</div></div>
    <div class="stat-card tomorrow" data-filter="tomorrow"><div class="stat-icon">üìÜ</div><div class="stat-number" id="count-tomorrow">0</div><div class="stat-label">Tomorrow</div></div>
    <div class="stat-card upcoming" data-filter="upcoming"><div class="stat-icon">üìã</div><div class="stat-number" id="count-upcoming">0</div><div class="stat-label">Next 15 Days</div></div>
  </div>
  <div class="cases-container">
    <div class="cases-header">
      <h2 class="cases-title" id="currentFilter">All High Priority Cases</h2>
      <p class="cases-subtitle" id="filterDescription">Showing all high priority cases in the system</p>
    </div>
    <div class="cases-content" id="casesContent"><div class="loading">Loading cases...</div></div>
  </div>
</div>
<div id="prayerModal" class="modal"><div class="modal-content"><div class="modal-header"><div class="modal-title">Prayer Details</div><span class="close" onclick="closePrayerModal()">&times;</span></div><div class="modal-body" id="prayerContent"></div></div></div>
<script>
  let cases = [];
  let currentFilter = 'all';
  const filterConfig = { all: { title: 'All High Priority Cases', description: 'Showing all high priority cases in the system' }, overdue: { title: 'Overdue Cases', description: 'Cases with hearing dates in the past' }, today: { title: 'Today\'s Cases', description: 'Cases scheduled for hearing today' }, tomorrow: { title: 'Tomorrow\'s Cases', description: 'Cases scheduled for hearing tomorrow' }, upcoming: { title: 'Upcoming Cases', description: 'Cases scheduled within the next 15 days' } };
  function formatDate(dateStr){ if(!dateStr) return 'Not scheduled'; const d=new Date(dateStr); const t=new Date(); const tm=new Date(t); tm.setDate(tm.getDate()+1); if(dateStr===t.toISOString().split('T')[0]) return 'üî¥ Today'; if(dateStr===tm.toISOString().split('T')[0]) return 'üü° Tomorrow'; if(d<t) return '‚ö†Ô∏è Overdue'; return d.toLocaleDateString('en-IN',{weekday:'short',day:'numeric',month:'short',year:'numeric'}); }
  function getCaseStatus(h){ if(!h) return ''; const t=new Date().toISOString().split('T')[0]; const tm=new Date(Date.now()+86400000).toISOString().split('T')[0]; if(h<t) return 'overdue'; if(h===t) return 'today'; if(h===tm) return 'tomorrow'; return 'upcoming'; }
  function updateStatCards(){ const t=new Date().toISOString().split('T')[0]; const tm=new Date(Date.now()+86400000).toISOString().split('T')[0]; const a15=new Date(Date.now()+15*86400000).toISOString().split('T')[0]; const counts={ all:cases.length, overdue:cases.filter(c=>c.next_hearing_date&&c.next_hearing_date<t).length, today:cases.filter(c=>c.next_hearing_date===t).length, tomorrow:cases.filter(c=>c.next_hearing_date===tm).length, upcoming:cases.filter(c=>c.next_hearing_date&&c.next_hearing_date>tm&&c.next_hearing_date<=a15).length }; Object.keys(counts).forEach(f=>{ const el=document.getElementById(`count-${f}`); if(el){ el.textContent=counts[f]; }}); }
  function filterCases(f){ const t=new Date().toISOString().split('T')[0]; const tm=new Date(Date.now()+86400000).toISOString().split('T')[0]; const a15=new Date(Date.now()+15*86400000).toISOString().split('T')[0]; return cases.filter(c=>{ const d=c.next_hearing_date; switch(f){ case 'all': return true; case 'overdue': return d&&d<t; case 'today': return d===t; case 'tomorrow': return d===tm; case 'upcoming': return d&&d>tm&&d<=a15; default: return true; } }); }
  function renderCases(f='all'){ currentFilter=f; const cfg=filterConfig[f]; document.getElementById('currentFilter').textContent=cfg.title; document.getElementById('filterDescription').textContent=cfg.description; document.querySelectorAll('.stat-card').forEach(c=>c.classList.remove('active')); const act=document.querySelector(`[data-filter="${f}"]`); if(act) act.classList.add('active'); const filtered=filterCases(f); const cont=document.getElementById('casesContent'); if(filtered.length===0){ cont.innerHTML = `<div class="no-cases"><div style="font-size:3rem;margin-bottom:15px;">üìù</div><div>No cases found for this filter</div></div>`; return; } const html=filtered.map(c=>{ const s=getCaseStatus(c.next_hearing_date); const hf=formatDate(c.next_hearing_date); return `<div class="case-card ${s}"><div class="case-header"><div class="case-info"><div class="case-title">${c.case_type||'Unknown Type'} - ${c.name||'N/A'}</div><div class="case-meta"><div class="meta-item"><span class="meta-icon">üèõÔ∏è</span><span>${c.court_number_and_judge||c.court_no||'N/A'}</span></div><div class="meta-item"><span class="meta-icon">üìã</span><span>CNR: ${c.cnr||'N/A'}</span></div><div class="meta-item"><span class="meta-icon">üìÑ</span><span>Item: ${c.item_no||'N/A'}</span></div><div class="meta-item"><span class="meta-icon">üìÖ</span><span>Next Hearing: ${c.next_hearing_date||'Not scheduled'}</span></div></div></div></div><div class="case-status"><span class="status-badge status-priority">High Priority</span><span class="status-badge status-stage">${c.case_stage||'Unknown Stage'}</span>${c.next_hearing_date?`<span class="status-badge status-hearing">${hf}</span>`:''}</div><div class="case-parties"><div class="party"><div class="party-label">Petitioner</div><div class="party-name">${c.pet_name||'Not specified'}</div></div><div class="party"><div class="party-label">Respondent</div><div class="party-name">${c.res_name||'Not specified'}</div></div></div>${c.synopsis?`<div class="case-synopsis"><strong>AI Synopsis:</strong> ${c.synopsis}</div>`:''}<div class="case-actions">${c.s3_html_link?`<a href="${c.s3_html_link}" target="_blank" class="btn btn-primary">üìÑ View Case</a>`:''}</div></div>`; }).join(''); cont.innerHTML=html; }
  function closePrayerModal(){ document.getElementById('prayerModal').style.display='none'; }
  document.querySelectorAll('.stat-card').forEach(card=>{ card.addEventListener('click',()=>{ renderCases(card.dataset.filter); }); });
  window.onclick=function(e){ const m=document.getElementById('prayerModal'); if(e.target===m){ m.style.display='none'; }}
  async function fetchData(){ const fields=["name","case_type","case_status","case_stage","case_categories","item_no","main_number","cnr","filing_no","court_no","court_number_and_judge","pet_name","res_name","cause_list_date","next_hearing_date","filing_date","priority","old_new","synopsis","synopsis_status","prayer","relevancy","s3_html_link","order_link","match_keyword","alert_to"]; const filters=[["priority","=","High"]]; const url=`/api/resource/CCMS2?limit=0&fields=${encodeURIComponent(JSON.stringify(fields))}&filters=${encodeURIComponent(JSON.stringify(filters))}`; try{ const resp=await fetch(url,{method:'GET',credentials:'include',headers:{'Accept':'application/json','X-Requested-With':'XMLHttpRequest'}}); if(!resp.ok){ const t=await resp.text(); throw new Error(`HTTP ${resp.status}: ${resp.statusText}\n${t}`);} const data=await resp.json(); cases=data.data||[]; updateStatCards(); renderCases(currentFilter); }catch(err){ console.error('Fetch error:',err); document.getElementById('casesContent').innerHTML = `<div class="error"><div style="font-size:2rem;margin-bottom:10px;">‚ùå</div><strong>Error fetching data:</strong><br><code>${err.message}</code></div>`; } }
  fetchData(); setInterval(fetchData, 5*60*1000);
</script>
</body>
</html>
